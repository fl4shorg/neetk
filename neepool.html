<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ùó°ùóñùó£ùóó</title>
    <link rel="icon" href="logo.jpg" type="image/jpeg">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
</head>
<body>
<div class="navbar">
    <h1><img src="atomo.png" alt="√çcone atomo" style="height: 30px;"> SISTEMA NCPD</h1>
</div>
<div class="navbar">
    <span><i class="fas fa-info-circle"></i> Atualiza√ß√£o 2.0 Beta</span>
</div>
<div class="user-text">
    <span id="icon"></span>
    <span id="greeting"></span>, 
    <span class="name"><i class="fas fa-user" style="color: #4A90E2;"></i>Tay</span>
</div>
<script>
    function updateGreeting() {
        const now = new Date();
        const hours = now.getHours();
        let greeting;
        let icon;
        if (hours < 6) {
            greeting = "Boa madrugada";
            icon = '<i class="fas fa-star" style="color: gold;"></i>';
        } else if (hours < 12) {
            greeting = "Bom dia";
            icon = '<i class="fas fa-sun" style="color: #FFCC00;"></i>';
        } else if (hours < 18) {
            greeting = "Boa tarde";
            icon = '<i class="fas fa-sun" style="color: #FFA500;"></i>';
        } else {
            greeting = "Boa noite";
            icon = '<i class="fas fa-moon" style="color: #1E90FF;"></i>';
        }
        document.getElementById("greeting").innerText = greeting;
        document.getElementById("icon").innerHTML = icon;
    }
    updateGreeting();
</script>

<div class="content">
    <input type="text" id="search" placeholder="Pesquisar pelo id...">
    <button onclick="searchData()"><i class="fas fa-search"></i> Pesquisar</button>
    <button onclick="fetchData()"><i class="fas fa-sync-alt"></i> Atualizar Lista</button>
    <button onclick="openSendDataPopup()"><i class="fas fa-paper-plane"></i> Enviar Dados</button>
</div>

<script>
    let currentRow;
    let isEditing = false;

    async function fetchData() {
        const response = await fetch("https://script.google.com/macros/s/AKfycbwMkU80r3XS-ECU-ULiz0AjtUwpLmEedtHTkGH0uxiF7lIgvAc1PSymUbSoxQxeDDxCWw/exec");
        const data = await response.text();
        const lines = data.trim().split("\n").slice(1);
        const container = document.getElementById("data");
        container.innerHTML = "";
        lines.forEach((line, index) => {
            const [id, name, age, number, instagram, email] = line.split(", ");
            const card = document.createElement("div");
            card.className = "card";
            card.innerHTML = `
                <h3><i class="fas fa-user"></i> ${name}</h3>
                <p><i class="fas fa-id-badge"></i> ID: ${id}</p>
                <p><i class="fas fa-calendar-alt"></i> Idade: ${age}</p>
                <p><i class="fas fa-phone"></i> N√∫mero: ${number}</p>
                <p><i class="fab fa-instagram"></i> Instagram: ${instagram}</p>
                <p><i class="fas fa-envelope"></i> Email: ${email}</p>
                <button onclick="confirmEdit(${index + 2}, '${id}', '${name}', '${age}', '${number}', '${instagram}', '${email}')">
                    <i class="fas fa-pencil-alt"></i> Editar
                </button>
                <button onclick="deleteData(${index + 2}, '${name}')">
                    <i class="fas fa-trash-alt"></i> Apagar
                </button>
            `;
            container.appendChild(card);
        });
    }

    async function confirmEdit(row, id, name, age, number, instagram, email) {
        currentRow = row;
        isEditing = true;
        swal({
            title: "Editar Dados",
            content: {
                element: "div",
                attributes: {
                    innerHTML: `
                        <input type="number" id="id" value="${id}" readonly>
                        <input type="text" id="name" value="${name}">
                        <input type="number" id="age" value="${age}">
                        <input type="text" id="number" value="${number}">
                        <input type="text" id="instagram" value="${instagram}">
                        <input type="email" id="email" value="${email}">
                    `,
                },
            },
            buttons: {
                cancel: "Cancelar",
                confirm: "Atualizar",
            },
        }).then(async (value) => {
            if (value) {
                const name = document.getElementById("name").value;
                const age = document.getElementById("age").value;
                const number = document.getElementById("number").value;
                const instagram = document.getElementById("instagram").value;
                const email = document.getElementById("email").value;

                if (!name || !age || !number || !email) {
                    swal("Erro!", "Todos os campos obrigat√≥rios devem ser preenchidos!", "error");
                    return;
                }

                await fetch("https://script.google.com/macros/s/AKfycbwMkU80r3XS-ECU-ULiz0AjtUwpLmEedtHTkGH0uxiF7lIgvAc1PSymUbSoxQxeDDxCWw/exec", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams({ action: "edit", row: currentRow, id, name, age, number, instagram, email })
                });

                swal("Sucesso!", "Dados atualizados com sucesso!", "success");
                fetchData();
                isEditing = false;
            }
        });
    }

    async function deleteData(row, name) {
        swal({
            title: "Voc√™ tem certeza?",
            text: `Deseja realmente apagar ${name}?`,
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then(async (willDelete) => {
            if (willDelete) {
                await fetch("https://script.google.com/macros/s/AKfycbwMkU80r3XS-ECU-ULiz0AjtUwpLmEedtHTkGH0uxiF7lIgvAc1PSymUbSoxQxeDDxCWw/exec", {
                    method: "POST",
                    headers: { "Content-Type": "application/x-www-form-urlencoded" },
                    body: new URLSearchParams({ action: "delete", row })
                });
                fetchData();
                swal("Apagado!", "Usu√°rio apagado com sucesso!", "success");
            }
        });
    }

    window.onload = fetchData;
</script>
</body>
</html>